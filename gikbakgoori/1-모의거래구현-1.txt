시간	상태	매수가	매도가	현재가	수량	매수금액	매도금액	수익률	현재가치


시뮬 트레이딩: 
초기 잔액: 1,000,000 KRW 현재 잔액: 1,000,000 KRW
매수 신호 기준값: 30% 50% 70%
익절 기준(%): 0.1 손절 기준(%): 0.1
자동 거래 시작

# 모의거래 기능 구현 계획 (Simul-Trading) - 업데이트됨

## 1. 개요 및 목표
- 암호화폐 분석 플랫폼에 모의거래(시뮬레이션 트레이딩) 기능 추가
- 실제 자금 투입 없이 트레이딩 전략 테스트 가능하도록 구현
- 분석 카드와 연동하여 실시간 데이터 기반 자동 매매 시뮬레이션 제공

## 2. 현재 구현된 사항 및 변경점
- 카드 ID 시스템: 백엔드에서 생성된 ID를 우선적으로 사용하도록 개선
- 카드 식별 방법: 타임스탬프 기반의 안정적인 ID 생성 방식 구현 완료
- 임시 ID 생성 및 백엔드 ID 업데이트 로직 구현 완료
- 메시지 콜백 시스템 개선으로 ID 변경 후에도 데이터 업데이트 정상 작동

## 3. 구현된 데이터 흐름

### 3.1 카드 식별 시스템 개선
- FormatUtils.generateShortId() 함수 개선:
  * 타임스탬프와 랜덤 문자열을 결합한 고유 ID 생성
  * 더 안정적인 ID 생성 방식으로 변경
- 카드 생성 시 임시 ID 생성:
  * 기본 ID 형식: `${exchange}-${quoteCurrency}-${symbol}`
  * 임시 ID 형식: `${baseId}-${shortId}`
- 카드 요소에 데이터 속성으로 저장:
  * data-base-id: 기본 ID (거래소-화폐쌍 형식)
  * data-short-id: 짧은 고유 식별자
  * data-created-at: 카드 생성 시간
  * data-exchange, data-currency-pair 등 기타 필요 정보

### 3.2 백엔드 ID 처리 및 업데이트
- 웹소켓 연결 시 임시 ID 사용
- 백엔드에서 받은 최종 ID로 업데이트하는 로직 구현
- ID 변경 시 다음 항목 업데이트:
  * 카드 ID (card.id)
  * 카드 ID 표시 (card-id-display)
  * 연결 맵 (activeConnections)
  * 메시지 콜백 맵 (messageCallbacks)
  * 상태 객체 (window.state.activeCards)

### 3.3 메시지 콜백 시스템 개선
- 카드 ID 변경 후에도 메시지 콜백이 계속 작동하도록 개선
- 콜백 재등록 로직 추가:
  * ID 변경 시 새 ID로 콜백 등록
  * 이전 ID의 콜백 제거
- 콜백이 없는 경우 대체 로직 추가:
  * 카드 컴포넌트 직접 업데이트 시도

### 3.4 상태 관리 개선
- 카드 정보를 ID 기반으로 저장하고 관리
- ID 변경 시 상태 객체도 함께 업데이트
- 중복 카드 생성 방지 로직 개선:
  * baseId 기반으로 중복 체크
  * Object.values(state.activeCards).some() 사용

## 4. 추가 구현 필요 사항

### 4.1 모의거래 UI 구축
- analysis.html에 모의거래 섹션 추가
- 카드 선택 드롭다운 구현:
  * 현재 활성화된 모든 분석 카드 목록 표시
  * 카드 선택 시 해당 카드 ID와 정보 가져오기
- 모의거래 설정 폼 구현:
  * 초기 잔액, 매수 신호 기준값, 익절/손절 기준 설정
  * 선택된 카드 정보 히든 필드에 저장

### 4.2 백엔드 연동 및 데이터 전송
- "자동거래시작" 버튼 클릭 시 이벤트 핸들러 구현
- 선택된 카드의 데이터와 사용자 설정을 결합하여 요청 데이터 구성
- 백엔드 API로 데이터 전송 (POST 요청)
- 응답에 따른 UI 상태 업데이트

### 4.3 실시간 거래 내역 표시
- 웹소켓 연결을 통해 거래 내역 수신
- 테이블에 거래 내역 실시간 추가/업데이트
- 현재 상태 정보 (잔액, 수익률 등) 갱신

## 5. 디버깅 및 로깅 개선
- 로그 메시지 명확화:
  * 카드 ID 변경 과정 상세 로깅
  * 웹소켓 메시지 처리 과정 로깅
- 오류 처리 개선:
  * 예외 상황 처리 및 사용자 피드백
  * 콜백 없는 경우 대체 로직 제공

이 계획에 따라 카드 ID 시스템과 메시지 콜백 시스템이 개선되었으며, 이제 모의거래 UI 구축과 백엔드 연동을 진행할 수 있습니다. 개선된 ID 시스템을 통해 카드 식별이 더 안정적으로 이루어지고, 백엔드에서 생성된 ID가 우선적으로 사용되어 데이터 일관성이 향상되었습니다.